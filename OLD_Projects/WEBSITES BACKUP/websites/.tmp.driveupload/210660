(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[694],{9875:function(e,s,t){Promise.resolve().then(t.bind(t,8745))},8745:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return d}});var i=t(7437),r=t(2265),l=t(7823),a=t(1812),c=t.n(a);function d(){let[e,s]=(0,r.useState)({step:"upload",csvData:[],previewData:[]}),t=async()=>{s(e=>({...e,step:"importing"}));let t=0,i=0,r=[];for(let s=0;s<e.csvData.length;s++){let a=e.csvData[s];try{let e=a.distance_meters/1609.344,c=e>=1?"".concat(e.toFixed(2)," mi"):"".concat((5280*e).toFixed(0)," ft"),d="".concat(a.Venue.trim()," | ").concat(a.distance_meters,"m (").concat(c,")"),n=4747/a.distance_meters*(1.17688/a.mile_difficulty),m=Math.round(1e3*n)/1e3,{data:o}=await l.OQ.from("courses").select("id, name").ilike("name","".concat(a.Venue.trim(),"%")).gte("distance_meters",a.distance_meters-50).lte("distance_meters",a.distance_meters+50);if(o&&o.length>0){let{error:e}=await l.OQ.from("courses").update({name:d,distance_meters:a.distance_meters,mile_difficulty:a.mile_difficulty,xc_time_rating:m,rating_confidence:"estimated"}).eq("id",o[0].id);e?r.push("".concat(a.Venue,": Update failed - ").concat(e.message)):i++}else{let{error:e}=await l.OQ.from("courses").insert({name:d,distance_meters:a.distance_meters,mile_difficulty:a.mile_difficulty,xc_time_rating:m,rating_confidence:"estimated"});e?r.push("".concat(a.Venue,": Create failed - ").concat(e.message)):t++}s%20==0&&await new Promise(e=>setTimeout(e,100))}catch(e){r.push("".concat(a.Venue,": ").concat(e instanceof Error?e.message:"Unknown error"))}}s(e=>({...e,step:"complete",importResult:{created:t,updated:i,errors:r}}))},a=()=>{s({step:"upload",csvData:[],previewData:[]})},{isValid:d,issues:n}="preview"===e.step?(()=>{let s=[];if(0===e.csvData.length)return s.push("No data found in CSV file"),{isValid:!1,issues:s};let t=e.csvData[0];t.Venue||s.push('Missing "Venue" column'),t.distance_meters||s.push('Missing "distance_meters" column'),t.mile_difficulty||s.push('Missing "mile_difficulty" column');let i=e.previewData.filter(e=>e.distance_meters<800||e.distance_meters>1e4);i.length>0&&s.push("".concat(i.length," courses have unusual distances (outside 800-10000m)"));let r=e.previewData.filter(e=>e.mile_difficulty<.8||e.mile_difficulty>3);return r.length>0&&s.push("".concat(r.length," courses have unusual difficulty ratings (outside 0.8-3.0)")),{isValid:0===s.length,issues:s}})():{isValid:!0,issues:[]};return(0,i.jsx)("div",{className:"container mx-auto p-6",children:(0,i.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"Import Courses from CSV"}),(0,i.jsx)("p",{className:"text-gray-600",children:"Upload your AllCourses.csv file to import all venues with correct XC ratings"})]}),e.error&&(0,i.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded mb-6",children:e.error}),(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow",children:["upload"===e.step&&(0,i.jsx)("div",{className:"p-6",children:(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"csv-file",className:"block text-sm font-medium text-gray-700 mb-2",children:"Select CSV File"}),(0,i.jsx)("input",{id:"csv-file",type:"file",accept:".csv",onChange:e=>{var t;let i=null===(t=e.target.files)||void 0===t?void 0:t[0];i&&(s(e=>({...e,error:void 0})),c().parse(i,{header:!0,skipEmptyLines:!0,dynamicTyping:!0,complete:e=>{try{let t=e.data.filter(e=>e.Venue&&e.distance_meters>0&&e.mile_difficulty>0);if(0===t.length){s(e=>({...e,error:"No valid courses found in CSV. Check column names and data format."}));return}let i=t.slice(0,10);s(e=>({...e,step:"preview",csvData:t,previewData:i}))}catch(e){s(s=>({...s,error:e instanceof Error?e.message:"Failed to process CSV"}))}},error:e=>{s(s=>({...s,error:"CSV parsing error: ".concat(e.message)}))}}))},className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-green-50 file:text-green-700 hover:file:bg-green-100"})]}),(0,i.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,i.jsx)("h3",{className:"font-medium text-blue-900 mb-3",children:"Expected CSV Format:"}),(0,i.jsxs)("div",{className:"text-sm text-blue-800 space-y-2",children:[(0,i.jsx)("p",{children:(0,i.jsx)("strong",{children:"Required columns:"})}),(0,i.jsxs)("ul",{className:"list-disc list-inside ml-4 space-y-1",children:[(0,i.jsxs)("li",{children:[(0,i.jsx)("code",{children:"Venue"})," - Course venue name"]}),(0,i.jsxs)("li",{children:[(0,i.jsx)("code",{children:"distance_meters"})," - Distance in meters"]}),(0,i.jsxs)("li",{children:[(0,i.jsx)("code",{children:"mile_difficulty"})," - Difficulty vs 1-mile track"]})]}),(0,i.jsx)("p",{className:"mt-3",children:(0,i.jsx)("strong",{children:"Example:"})}),(0,i.jsxs)("code",{className:"block bg-white p-2 rounded text-xs",children:["Venue,distance_meters,mile_difficulty",(0,i.jsx)("br",{}),"Crystal Springs,4747,1.17688",(0,i.jsx)("br",{}),"Alum Rock Park,3701,1.13235"]})]})]})]})}),"preview"===e.step&&(0,i.jsxs)("div",{className:"p-6",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"text-xl font-semibold",children:"Preview Import Data"}),(0,i.jsxs)("p",{className:"text-sm text-gray-600",children:["Found ",e.csvData.length," courses. Showing first 10 rows."]})]}),(0,i.jsx)("div",{className:"px-3 py-1 rounded text-sm font-medium ".concat(d?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:d?"Valid":"Issues Found"})]}),!d&&(0,i.jsxs)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded mb-4",children:[(0,i.jsx)("p",{className:"font-medium mb-2",children:"Data validation issues:"}),(0,i.jsx)("ul",{className:"list-disc list-inside text-sm",children:n.map((e,s)=>(0,i.jsx)("li",{children:e},s))})]}),(0,i.jsx)("div",{className:"overflow-x-auto mb-6",children:(0,i.jsxs)("table",{className:"min-w-full text-sm",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"border-b bg-gray-50",children:[(0,i.jsx)("th",{className:"text-left p-3",children:"Venue"}),(0,i.jsx)("th",{className:"text-left p-3",children:"Distance (m)"}),(0,i.jsx)("th",{className:"text-left p-3",children:"Distance (mi)"}),(0,i.jsx)("th",{className:"text-left p-3",children:"Difficulty"}),(0,i.jsx)("th",{className:"text-left p-3",children:"Calculated XC Rating"}),(0,i.jsx)("th",{className:"text-left p-3",children:"Generated Name"})]})}),(0,i.jsx)("tbody",{children:e.previewData.map((e,s)=>{let t=e.distance_meters/1609.344,r=t>=1?"".concat(t.toFixed(2)," mi"):"".concat((5280*t).toFixed(0)," ft"),l="".concat(e.Venue.trim()," | ").concat(e.distance_meters,"m (").concat(r,")"),a=4747/e.distance_meters*(1.17688/e.mile_difficulty);return(0,i.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,i.jsx)("td",{className:"p-3",children:e.Venue}),(0,i.jsx)("td",{className:"p-3",children:e.distance_meters}),(0,i.jsx)("td",{className:"p-3",children:t.toFixed(2)}),(0,i.jsx)("td",{className:"p-3",children:e.mile_difficulty}),(0,i.jsx)("td",{className:"p-3",children:a.toFixed(3)}),(0,i.jsx)("td",{className:"p-3 text-xs",children:l})]},s)})})]})}),(0,i.jsxs)("div",{className:"flex gap-3",children:[(0,i.jsxs)("button",{onClick:t,disabled:!d,className:"bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:["Import ",e.csvData.length," Courses"]}),(0,i.jsx)("button",{onClick:a,className:"bg-gray-600 text-white px-6 py-2 rounded hover:bg-gray-700",children:"Choose Different File"})]})]}),"importing"===e.step&&(0,i.jsxs)("div",{className:"p-6 text-center",children:[(0,i.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto mb-4"}),(0,i.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Importing Courses..."}),(0,i.jsxs)("p",{className:"text-gray-600",children:["Processing ",e.csvData.length," courses. This may take a few minutes."]})]}),"complete"===e.step&&e.importResult&&(0,i.jsxs)("div",{className:"p-6",children:[(0,i.jsxs)("div",{className:"text-center mb-6",children:[(0,i.jsx)("div",{className:"text-4xl mb-2",children:"✓"}),(0,i.jsx)("h2",{className:"text-2xl font-semibold text-green-600",children:"Import Complete!"})]}),(0,i.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[(0,i.jsxs)("div",{className:"text-center bg-green-50 p-4 rounded",children:[(0,i.jsx)("div",{className:"text-2xl font-bold text-green-600",children:e.importResult.created}),(0,i.jsx)("div",{className:"text-sm text-green-800",children:"Created"})]}),(0,i.jsxs)("div",{className:"text-center bg-blue-50 p-4 rounded",children:[(0,i.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:e.importResult.updated}),(0,i.jsx)("div",{className:"text-sm text-blue-800",children:"Updated"})]}),(0,i.jsxs)("div",{className:"text-center bg-red-50 p-4 rounded",children:[(0,i.jsx)("div",{className:"text-2xl font-bold text-red-600",children:e.importResult.errors.length}),(0,i.jsx)("div",{className:"text-sm text-red-800",children:"Errors"})]})]}),e.importResult.errors.length>0&&(0,i.jsxs)("div",{className:"bg-red-50 border border-red-200 p-4 rounded mb-6",children:[(0,i.jsx)("h3",{className:"font-medium text-red-800 mb-2",children:"Import Errors:"}),(0,i.jsx)("div",{className:"max-h-32 overflow-y-auto",children:(0,i.jsx)("ul",{className:"text-sm text-red-700 space-y-1",children:e.importResult.errors.map((e,s)=>(0,i.jsxs)("li",{children:["• ",e]},s))})})]}),(0,i.jsxs)("div",{className:"text-center space-x-3",children:[(0,i.jsx)("a",{href:"/courses",className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700",children:"View All Courses"}),(0,i.jsx)("button",{onClick:a,className:"bg-gray-600 text-white px-6 py-2 rounded hover:bg-gray-700",children:"Import Another File"})]})]})]})]})})}}},function(e){e.O(0,[872,668,971,472,744],function(){return e(e.s=9875)}),_N_E=e.O()}]);