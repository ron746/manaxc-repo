(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[806],{9717:function(e,t,s){Promise.resolve().then(s.bind(s,3947))},3947:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return u}});var a=s(7437),r=s(2265),l=s(7823),i=s(1812),n=s.n(i);async function d(e,t,s){let{data:a}=await l.OQ.from("courses").select("id").eq("name",e).eq("distance_meters",t).single();if(a)return a.id;let{data:r}=await l.OQ.from("courses").select("id, name, distance_meters");if(r)for(let s of r){let a=s.name.toLowerCase().includes(e.toLowerCase())||e.toLowerCase().includes(s.name.toLowerCase()),r=50>=Math.abs(s.distance_meters-t);if(a&&r)return console.log("Fuzzy matched: ".concat(e," (").concat(t,"m) → ").concat(s.name," (").concat(s.distance_meters,"m)")),s.id}let i=621371e-9*t,n=4747/t*1.17688,{data:d,error:c}=await l.OQ.from("courses").insert({name:"".concat(e," | ").concat(t,"m (").concat(i.toFixed(2)," mi)"),distance_meters:t,mile_difficulty:1,xc_time_rating:n,rating_confidence:"estimated"}).select("id").single();if(c)throw c;return s.coursesCreated++,d.id}async function c(e,t){let{data:s}=await l.OQ.from("schools").select("id").eq("name",e).single();if(s)return s.id;let{data:a,error:r}=await l.OQ.from("schools").insert({name:e}).select("id").single();if(r)throw r;return t.schoolsCreated++,a.id}async function o(e,t,s,a,r,i){let{data:n}=await l.OQ.from("athletes").select("id").eq("first_name",e).eq("last_name",t).eq("graduation_year",s).single();if(n)return n.id;let{data:d,error:c}=await l.OQ.from("athletes").insert({first_name:e,last_name:t,graduation_year:s,gender:a,current_school_id:r}).select("id").single();if(c)throw c;return i.athletesCreated++,d.id}async function m(e,t,s,a){let{data:r}=await l.OQ.from("meets").select("id").eq("name",e).eq("meet_date",t).single();if(r)return r.id;let{data:i,error:n}=await l.OQ.from("meets").insert({name:e,meet_date:t,meet_type:s}).select("id").single();if(n)throw n;return a.meetsCreated++,i.id}async function x(e,t,s,a,r){let{data:i}=await l.OQ.from("races").select("id").eq("meet_id",e).eq("category",t).eq("gender",s).single();if(i)return i.id;let n="".concat(t," ").concat("M"===s?"Boys":"Girls"),{data:d,error:c}=await l.OQ.from("races").insert({meet_id:e,name:n,category:t,gender:s,course_id:a}).select("id").single();if(c)throw c;return r.racesCreated++,d.id}async function h(e){let t={totalRows:0,coursesCreated:0,schoolsCreated:0,athletesCreated:0,meetsCreated:0,racesCreated:0,resultsCreated:0,errors:[]};try{let s=await e.text(),a=n().parse(s,{header:!0,skipEmptyLines:!0,dynamicTyping:!0});t.totalRows=a.data.length;for(let e=0;e<a.data.length;e++){let s=a.data[e];try{let a=function(e){let t=e.split("/");if(3!==t.length)throw Error("Invalid date format: ".concat(e));let[s,a,r]=t.map(e=>parseInt(e));return r<100&&(r=r>=60?1900+r:2e3+r),"".concat(r,"-").concat(String(s).padStart(2,"0"),"-").concat(String(a).padStart(2,"0"))}(s.meet_date),r=function(e){let t=e.split(":");if(2!==t.length)throw Error("Invalid time format: ".concat(e));let s=parseInt(t[0]),a=parseFloat(t[1]);return Math.round((60*s+a)*100)}(s.time),i="UNK"===s.race_category?"Varsity":s.race_category,n=await d(s.course_name,s.distance_meters,t),h=await c(s.school_name,t),u=await o(s.athlete_first_name,s.athlete_last_name,s.graduation_year,s.gender,h,t),g=await m(s.meet_name,a,s.meet_type,t),f=await x(g,i,s.gender,n,t),{error:b}=await l.OQ.from("results").insert({athlete_id:u,meet_id:g,race_id:f,time_seconds:r,place_overall:s.place,season_year:s.season});if(b)throw b;t.resultsCreated++,(e+1)%100==0&&console.log("Processed ".concat(e+1," / ").concat(t.totalRows," rows"))}catch(s){t.errors.push("Row ".concat(e+1,": ").concat(s instanceof Error?s.message:String(s)))}}return{success:0===t.errors.length,message:0===t.errors.length?"Import completed successfully":"Import completed with ".concat(t.errors.length," errors"),stats:t}}catch(e){return{success:!1,message:e instanceof Error?e.message:String(e),stats:t}}}function u(){let[e,t]=(0,r.useState)(null),[s,l]=(0,r.useState)(!1),[i,n]=(0,r.useState)(null),d=async()=>{if(e){l(!0),n(null);try{let t=await h(e);n(t)}catch(e){n({success:!1,message:e instanceof Error?e.message:"Import failed",stats:null})}finally{l(!1)}}};return(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 p-8",children:(0,a.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-slate-800 mb-2",children:"Mass Results Import"}),(0,a.jsx)("p",{className:"text-slate-600 mb-8",children:"Upload CSV file with meet results from multiple meets and courses"}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Select CSV File"}),(0,a.jsx)("input",{type:"file",accept:".csv",onChange:e=>{e.target.files&&e.target.files[0]&&(t(e.target.files[0]),n(null))},disabled:s,className:"block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 disabled:opacity-50"}),e&&(0,a.jsxs)("p",{className:"mt-2 text-sm text-slate-600",children:["Selected: ",e.name," (",(e.size/1024).toFixed(1)," KB)"]})]}),(0,a.jsx)("button",{onClick:d,disabled:!e||s,className:"w-full bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:s?"Importing...":"Start Import"}),s&&(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mr-3"}),(0,a.jsx)("span",{className:"text-slate-700",children:"Processing rows... Check console for progress"})]})}),i&&(0,a.jsxs)("div",{className:"mt-6 p-6 rounded-lg ".concat(i.success?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"),children:[(0,a.jsx)("h2",{className:"text-lg font-bold mb-4 ".concat(i.success?"text-green-800":"text-red-800"),children:i.message}),i.stats&&(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-slate-800",children:i.stats.totalRows}),(0,a.jsx)("div",{className:"text-sm text-slate-600",children:"Total Rows"})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:i.stats.resultsCreated}),(0,a.jsx)("div",{className:"text-sm text-slate-600",children:"Results Created"})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:i.stats.coursesCreated}),(0,a.jsx)("div",{className:"text-sm text-slate-600",children:"Courses Created"})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:i.stats.schoolsCreated}),(0,a.jsx)("div",{className:"text-sm text-slate-600",children:"Schools Created"})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:i.stats.athletesCreated}),(0,a.jsx)("div",{className:"text-sm text-slate-600",children:"Athletes Created"})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-pink-600",children:i.stats.meetsCreated}),(0,a.jsx)("div",{className:"text-sm text-slate-600",children:"Meets Created"})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-indigo-600",children:i.stats.racesCreated}),(0,a.jsx)("div",{className:"text-sm text-slate-600",children:"Races Created"})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-red-600",children:i.stats.errors.length}),(0,a.jsx)("div",{className:"text-sm text-slate-600",children:"Errors"})]})]}),i.stats&&i.stats.errors.length>0&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsxs)("h3",{className:"font-semibold text-red-800 mb-2",children:["Errors (",i.stats.errors.length,"):"]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 max-h-60 overflow-y-auto",children:[i.stats.errors.slice(0,50).map((e,t)=>(0,a.jsxs)("div",{className:"text-sm text-red-700 mb-1",children:["• ",e]},t)),i.stats.errors.length>50&&(0,a.jsxs)("div",{className:"text-sm text-red-600 font-semibold mt-2",children:["... and ",i.stats.errors.length-50," more errors"]})]})]})]}),(0,a.jsxs)("div",{className:"mt-8 p-6 bg-slate-50 rounded-lg border border-slate-200",children:[(0,a.jsx)("h3",{className:"font-semibold text-slate-800 mb-3",children:"CSV Format Requirements:"}),(0,a.jsxs)("ul",{className:"text-sm text-slate-600 space-y-2",children:[(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"meet_date:"})," MM/DD/YY format (handles 1960s-2025)"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"time:"})," MM:SS.S format"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"gender:"})," M or F"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"distance_meters:"})," Integer (e.g., 4747, 5000)"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"race_category:"}),' Use "UNK" to default to Varsity']}),(0,a.jsx)("li",{children:"• Intelligent course matching: exact → fuzzy (\xb150m) → create new"}),(0,a.jsx)("li",{children:"• Progress logged to console every 100 rows"})]})]})]})})})}}},function(e){e.O(0,[872,668,971,472,744],function(){return e(e.s=9717)}),_N_E=e.O()}]);