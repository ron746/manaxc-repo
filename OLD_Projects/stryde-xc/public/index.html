<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Westmont XC</title>
    <link rel="icon" type="image/png" href="/favicon.png">

<link href="/output.css" rel="stylesheet">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; }
        .modal-backdrop { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 40; transition: opacity 0.3s ease; }
        .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 50; }
        .modal-enter { animation: fadeIn 0.3s ease-out forwards; }
        .modal-leave { animation: fadeOut 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translate(-50%, -45%); } to { opacity: 1; transform: translate(-50%, -50%); } }
        @keyframes fadeOut { from { opacity: 1; transform: translate(-50%, -50%); } to { opacity: 0; transform: translate(-50%, -45%); } }
        .table-loading-spinner, .page-loading-spinner { display: flex; justify-content: center; align-items: center; min-height: 150px; }
        #aiProcessingOverlay { display: none; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(255, 255, 255, 0.9); z-index: 60; border-radius: 1rem; }
        .view { display: none; }
        .nav-link { padding: 8px 16px; border-radius: 9999px; font-weight: 600; transition: background-color 0.2s, color 0.2s; cursor: pointer; }
        .nav-link.active { background-color: #fee2e2; color: #991b1b; }
        .nav-link:not(.active) { color: #4b5563; }
        .nav-link:not(.active):hover { background-color: #f3f4f6; }
        .sortable-header { cursor: pointer; user-select: none; }
        .sortable-header:hover { background-color: #e5e7eb; }
        .sticky-header thead { position: sticky; top: 0; z-index: 10; }
    </style>
</head>
<body class="bg-gray-100">

    <header class="bg-white shadow-md sticky top-0 z-30">
        <nav class="container mx-auto px-4 py-3 flex justify-between items-center">
            <a href="#" id="homeNav" class="flex items-center space-x-2">
                <img src="https://firebasestorage.googleapis.com/v0/b/stryde-xc.firebasestorage.app/o/Shield%20XC%20Logo.png?alt=media&token=0a5582f6-dfca-47a0-ace4-400e8c85a007" alt="Westmont XC Logo" class="h-10 w-auto">
                <span class="text-2xl font-bold text-black">Westmont XC</span>
            </a>
            <div class="flex items-center space-x-4">
                <div class="hidden md:flex items-center space-x-2 bg-gray-100 rounded-full p-1">
                    <a id="meetsNav" class="nav-link">Meets</a>
                    <a id="teamsNav" class="nav-link">Teams</a>
                    <a id="schoolsNav" class="nav-link">Schools</a>
                    <a id="athletesNav" class="nav-link">Athletes</a>
                </div>
                <div class="flex space-x-2">
                    <button id="manageCoursesBtn" class="bg-gray-200 text-gray-800 font-semibold px-4 py-2 rounded-lg hover:bg-gray-300">Courses</button>
                    <button id="uploadMeetBtn" class="bg-red-600 text-white font-semibold px-4 py-2 rounded-lg hover:bg-red-700">Upload Meet</button>
                </div>
            </div>
        </nav>
    </header>

   <main class="container mx-auto p-4 md:p-8">

    <div id="meetsListView" class="view">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
            
            <div class="md:col-span-1">
                <div id="sidebarContainer" class="bg-white rounded-lg shadow-lg p-4"></div>
            </div>

            <div id="meetsContainer" class="md:col-span-3 bg-white rounded-lg shadow-lg p-6">
                <div class="page-loading-spinner">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto mb-4"></div>
                    <p class="text-gray-500 text-lg ml-4">Loading meets...</p>
                </div>
            </div>

        </div> <div class="text-center mt-6">
            <button id="loadMoreMeetsBtn" class="bg-red-600 text-white font-semibold px-6 py-3 rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                Load More
            </button>
        </div>
    </div>

    <div id="meetPageView" class="view">
        <div class="bg-white rounded-lg shadow-lg p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 id="meetPageTitle" class="text-2xl font-bold text-gray-800"></h2>
                <button id="backToMeetsBtn" class="bg-gray-200 text-gray-800 font-semibold px-4 py-2 rounded-lg hover:bg-gray-300">&larr; All Meets</button>
            </div>
            <div id="meetPageRacesContainer"></div>
        </div>
    </div>

    <div id="resultsView" class="view">
        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
            <div class="p-4 bg-gray-50 border-b flex justify-between items-center">
                <div>
                    <h2 id="resultsRaceTitle" class="text-xl font-bold text-gray-800"></h2>
                    <p id="resultsRaceInfo" class="text-sm text-gray-500"></p>
                </div>
                <button id="backToMeetBtn" class="bg-gray-200 text-gray-800 font-semibold px-4 py-2 rounded-lg hover:bg-gray-300">&larr; Back to Meet</button>
            </div>
            <div id="resultsTableContainerWrapper" class="max-h-[80vh] overflow-y-auto">
                <div id="resultsTableContainer"></div>
            </div>
            <div id="resultsPaginationContainer" class="p-4 flex justify-center items-center"></div>
        </div>
    </div>

    <div id="schoolsView" class="view">
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Schools</h2>
            <input type="search" id="schoolSearchInput" class="w-full px-4 py-2 border rounded-md shadow-sm focus:ring-red-500 focus:border-red-500 mb-4" placeholder="Search for a school...">
            <div id="schoolsContainer" class="max-h-[70vh] overflow-y-auto"></div>
        </div>
    </div>

<div id="athletesView" class="view">
    <div class="bg-white rounded-lg shadow-lg p-6">
        <h2 class="text-2xl font-bold text-gray-800 mb-4">Athletes</h2>
        <input type="search" id="athleteSearchInput" ...>
        <div id="athletesContainer" class="max-h-[70vh] overflow-y-auto"></div>

        <div class="text-center mt-6">
            <button id="loadMoreAthletesBtn" class="bg-red-600 text-white font-semibold px-6 py-3 rounded-lg hover:bg-red-700">
                Load More
            </button>
        </div>

    </div>
</div>

    <div id="schoolRosterView" class="view">
        <div class="bg-white rounded-lg shadow-lg p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 id="schoolRosterTitle" class="text-2xl font-bold text-gray-800"></h2>
                <div class="flex space-x-2">
                    <button id="seasonRankingsBtn" class="bg-red-600 text-white font-semibold px-4 py-2 rounded-lg hover:bg-red-700">Season Rankings</button>
                    <button id="top50Btn" class="bg-gray-200 text-gray-800 font-semibold px-4 py-2 rounded-lg hover:bg-gray-300">Top 50 (All Time)</button>
                    <button id="backToSchoolsBtn" class="bg-gray-200 text-gray-800 font-semibold px-4 py-2 rounded-lg hover:bg-gray-300">&larr; All Schools</button>
                </div>
            </div>
            <div id="schoolRosterContainer" class="max-h-[70vh] overflow-y-auto"></div>
        </div>
    </div>

<div id="athleteResultsView" class="view">
    <div class="bg-white rounded-lg shadow-lg p-6">
        <div class="flex justify-between items-center mb-4">
            <div>
                <h2 id="athleteResultsTitle" class="text-2xl font-bold text-gray-800"></h2>
                <p id="athleteResultsSubtitle" class="text-md text-gray-500"></p>
            </div>
            <div>
                <button id="predictRaceBtn" class="bg-blue-600 text-white font-semibold px-4 py-2 rounded-lg hover:bg-blue-700 mr-2">Predict Race</button>
                <button id="backToSourceBtn" class="bg-gray-200 text-gray-800 font-semibold px-4 py-2 rounded-lg hover:bg-gray-300">&larr; Back</button>
            </div>
        </div>
        <div class="mb-6 p-4 bg-gray-50 rounded-lg">
            <canvas id="athleteChart"></canvas>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6 text-center">
            <div id="summaryStatsContainer" class="p-4 bg-white rounded-lg shadow"></div>
            <div id="personalRecordsContainer" class="p-4 bg-white rounded-lg shadow"></div>
            <div id="seasonBestsContainer" class="p-4 bg-white rounded-lg shadow"></div>
        </div>
        <div id="athleteResultsContainer" class="max-h-[70vh] overflow-y-auto"></div>
    </div>
</div>


    </div>
        </div> <div class="text-center mt-6">
            <button id="loadMoreMeetsBtn" ...>
                Load More
            </button>
        </div>
    </div>

    <div id="top50View" class="view">
        <div class="bg-white rounded-lg shadow-lg p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 id="top50Title" class="text-2xl font-bold text-gray-800"></h2>
                <button id="backToRosterBtn" class="bg-gray-200 text-gray-800 font-semibold px-4 py-2 rounded-lg hover:bg-gray-300">&larr; Roster</button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4 p-4 bg-gray-50 rounded-lg">
                <select id="top50CourseSelect" class="p-2 border rounded-md"></select>
                <select id="top50GenderSelect" class="p-2 border rounded-md">
                    <option value="All">All Genders</option>
                    <option value="B">Boys</option>
                    <option value="G">Girls</option>
                </select>
                <select id="top50GradeSelect" class="p-2 border rounded-md">
                    <option value="All">All Grades</option>
                    <option value="9">9th</option>
                    <option value="10">10th</option>
                    <option value="11">11th</option>
                    <option value="12">12th</option>
                </select>
            </div>
            <div id="top50Container" class="max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>

    <div id="schoolRankingsView" class="view">
        <div class="bg-white rounded-lg shadow-lg p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 id="schoolRankingsTitle" class="text-2xl font-bold text-gray-800"></h2>
                <button id="backToRosterFromRankingsBtn" class="bg-gray-200 text-gray-800 font-semibold px-4 py-2 rounded-lg hover:bg-gray-300">&larr; Roster</button>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4 p-4 bg-gray-50 rounded-lg">
                <div>
                    <label for="rankingsSeasonSelect" class="block text-sm font-medium text-gray-700">Season</label>
                    <select id="rankingsSeasonSelect" class="mt-1 block w-full p-2 border rounded-md"></select>
                </div>
                <div>
                    <label for="rankingsGenderSelect" class="block text-sm font-medium text-gray-700">Gender</label>
                    <select id="rankingsGenderSelect" class="mt-1 block w-full p-2 border rounded-md">
                        <option value="All">All Genders</option>
                        <option value="B">Boys</option>
                        <option value="G">Girls</option>
                    </select>
                </div>
                <div>
                    <label for="rankingsGradeSelect" class="block text-sm font-medium text-gray-700">Grade</label>
                    <select id="rankingsGradeSelect" class="mt-1 block w-full p-2 border rounded-md">
                        <option value="All">All Grades</option>
                        <option value="9">9th</option>
                        <option value="10">10th</option>
                        <option value="11">11th</option>
                        <option value="12">12th</option>
                    </select>
                </div>
                <div>
                    <label for="rankingsMetricSelect" class="block text-sm font-medium text-gray-700">Rank By</label>
                    <select id="rankingsMetricSelect" class="mt-1 block w-full p-2 border rounded-md">
                        <option value="best">Best xcTime</option>
                        <option value="average">Average xcTime</option>
                    </select>
                </div>
            </div>
            <div id="teamTimeContainer" class="mb-6 p-4 bg-white rounded-lg shadow text-center"></div>
            <div id="schoolRankingsContainer" class="max-h-[70vh] overflow-y-auto"></div>
        </div>
    </div>

    <div id="teamRankingsView" class="view">
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Team Season Rankings</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4 p-4 bg-gray-50 rounded-lg">
                <select id="teamRankingsSeasonSelect" class="p-2 border rounded-md"></select>
                <select id="teamRankingsGenderSelect" class="p-2 border rounded-md">
                    <option value="B">Boys</option>
                    <option value="G">Girls</option>
                </select>
                <select id="teamRankingsCourseSelect" class="p-2 border rounded-md">
                    <option value="All">All Courses</option>
                </select>
            </div>
            <div id="teamRankingsContainer" class="max-h-[70vh] overflow-y-auto"></div>
        </div>
    </div>
    
</main>

    <div id="uploadModalBackdrop" class="modal-backdrop"></div><div id="uploadModal" class="modal w-full max-w-lg bg-white rounded-2xl shadow-xl p-6 relative"><h2 class="text-2xl font-bold text-gray-800 mb-4">Upload Meet Results</h2><form id="uploadForm"><div class="mb-4"><label for="meetName" class="block text-sm font-medium text-gray-700 mb-1">Meet Name</label><input type="text" id="meetName" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500" placeholder="e.g., Clovis Invitational" required></div><div class="mb-4"><label for="meetDate" class="block text-sm font-medium text-gray-700 mb-1">Meet Date</label><input type="date" id="meetDate" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500" required></div><div class="mb-4"><label for="meetVenue" class="block text-sm font-medium text-gray-700 mb-1">Venue / Location</label><input type="text" id="meetVenue" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="e.g., Crystal Springs Park" required></div><div class="mb-6"><p class="block text-sm font-medium text-gray-700 mb-2">Upload Results File</p><div class="flex items-center justify-center space-x-4 p-4 bg-gray-50 rounded-lg"><label for="csvUploadInput" class="text-center cursor-pointer p-4 rounded-lg hover:bg-red-100 border-2 border-dashed border-gray-300 hover:border-red-400 transition-colors flex-1"><span class="text-4xl">📄</span><span class="block text-sm font-semibold text-gray-700 mt-2">Upload CSV</span><input type="file" id="csvUploadInput" class="hidden" accept=".csv,.txt"></label><label for="pdfUploadInput" class="text-center cursor-pointer p-4 rounded-lg hover:bg-red-100 border-2 border-dashed border-gray-300 hover:border-red-400 transition-colors flex-1"><span class="text-4xl">🤖</span><span class="block text-sm font-semibold text-gray-700 mt-2">Upload PDF with AI</span><input type="file" id="pdfUploadInput" class="hidden" accept=".pdf"></label></div></div><div class="flex justify-end space-x-3 mt-4"><button type="button" id="cancelUpload" class="px-4 py-2 bg-gray-200 text-gray-700 font-medium rounded-lg hover:bg-gray-300">Close</button></div></form><div id="aiProcessingOverlay" class="flex items-center justify-center"><div class="text-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-red-600 mx-auto mb-4"></div><p class="text-gray-700 font-semibold">Processing File...</p><p class="text-gray-500 text-sm">This may take a moment.</p></div></div></div>
    <div id="raceConfirmationModalBackdrop" class="modal-backdrop"></div><div id="raceConfirmationModal" class="modal w-full max-w-3xl bg-white rounded-2xl shadow-xl p-6"><h2 class="text-2xl font-bold text-gray-800 mb-4">Confirm Races to Import</h2><p class="text-gray-600 mb-6">The following races were found. Please select the correct course for each race you want to import.</p><div id="detectedRacesContainer" class="space-y-4 max-h-[60vh] overflow-y-auto p-4 bg-gray-50 rounded-lg border"></div><div class="flex justify-end space-x-3 mt-6"><button type="button" id="cancelRaceConfirmation" class="px-4 py-2 bg-gray-200 text-gray-700 font-medium rounded-lg hover:bg-gray-300">Cancel</button><button type="button" id="importSelectedRacesBtn" class="px-4 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700">Import Selected Races</button></div></div>
    <div id="coursesModalBackdrop" class="modal-backdrop"></div><div id="coursesModal" class="modal w-full max-w-2xl bg-white rounded-2xl shadow-xl p-6"><h2 class="text-2xl font-bold text-gray-800 mb-6">Manage Courses</h2><div class="grid grid-cols-1 md:grid-cols-2 gap-8"><div><h3 class="text-lg font-semibold text-gray-700 mb-3">Add New Course</h3><form id="courseForm" class="space-y-4"><div><label for="courseName" class="block text-sm font-medium text-gray-700">Course Name</label><input type="text" id="courseName" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500" required></div><div><label for="courseDistance" class="block text-sm font-medium text-gray-700">Distance</label><div class="flex items-center space-x-2 mt-1"><input type="number" step="0.01" id="courseDistance" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500" placeholder="e.g., 5000" required><select id="distanceUnit" class="px-3 py-2 border border-gray-300 rounded-md shadow-sm"><option value="meters">meters</option><option value="miles">miles</option></select></div></div><div><label for="courseDifficulty" class="block text-sm font-medium text-gray-700">Difficulty (0-2)</label><input type="number" id="courseDifficulty" min="0" max="2" step="0.00000000000001" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500" placeholder="e.g., 1.0189" required></div><button type="submit" class="w-full px-4 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700">Add Course</button></form></div><div><h3 class="text-lg font-semibold text-gray-700 mb-3">Existing Courses</h3><div id="coursesListContainer" class="h-64 overflow-y-auto bg-gray-50 p-3 rounded-md border"></div></div></div><div class="flex justify-end mt-6"><button type="button" id="closeCoursesModal" class="px-4 py-2 bg-gray-200 text-gray-700 font-medium rounded-lg hover:bg-gray-300">Close</button></div></div>
    <div id="deleteModalBackdrop" class="modal-backdrop"></div><div id="deleteModal" class="modal w-full max-w-md bg-white rounded-2xl shadow-xl p-6"><h2 class="text-2xl font-bold text-gray-800 mb-2">Confirm Deletion</h2><p id="deleteMessage" class="text-gray-600 mb-6"></p><div class="flex justify-end space-x-3"><button type="button" id="cancelDelete" class="px-4 py-2 bg-gray-200 text-gray-700 font-medium rounded-lg hover:bg-gray-300">Cancel</button><button type="button" id="confirmDelete" class="px-4 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700">Delete</button></div></div>

<script type="module" src="/main.js"></script>
 
<div id="predictionModalBackdrop" class="modal-backdrop"></div>
<div id="predictionModal" class="modal w-full max-w-lg bg-white rounded-2xl shadow-xl p-6">
    <h2 class="text-2xl font-bold text-gray-800 mb-4">Race Time Prediction</h2>
    <div class="space-y-4">
        <div>
            <label for="predictCourseSelect" class="block text-sm font-medium text-gray-700">Select a Course to Predict Time For</label>
            <select id="predictCourseSelect" class="mt-1 block w-full p-2 border rounded-md"></select>
        </div>
        <div id="predictionResultContainer" class="hidden text-center p-4 bg-gray-50 rounded-lg">
            <p class="text-sm text-gray-600">Predicted Time (based on last 5 races):</p>
            <p id="predictedTimeText" class="text-3xl font-bold text-gray-800 my-1">--:--.--</p>
            <p id="predictedRangeText" class="text-sm text-gray-500">(Expected Range: --:--.-- to --:--.--)</p>
        </div>
    </div>
    <div class="flex justify-end space-x-3 mt-6">
        <button type="button" id="closePredictionModal" class="px-4 py-2 bg-gray-200 text-gray-700 font-medium rounded-lg hover:bg-gray-300">Close</button>
    </div>
</div>


</body>
</html>